# Реферальная система API

## Эндпоинты

### 1. Ввод номера телефона для авторизации
**POST** `/api/auth/phone/`

body:
```json
{
    "phone": "+375(29)724-21-45"
}
```
- View очищает номер от лишних символов
- Генерирует 4-значный код для авторизации и отправляет в cache.
- Срок жизни кода в cache (2 мин)

Успешный ответ:
```json
{
    "detail": "Код отправлен на ваш телефон",
    "code": "3681"
}
```
Ошибки:

- 400: Некорректный номер телефона

### 2. Авторизация/Регистрация
**POST** `/api/auth/verify/`

body:
```json
{
    "phone": "+375(29)724-21-45",
    "code": "3681"
}
```
- View очищает номер от лишних символов
- Регистрирует нового пользователя по номеру телефона
- Присваивает случайный инвайт-код для нового пользователя
- Авторизует нового/существующего пользователя

Успешный ответ:
```json
{
    "detail": "Пользователь авторизован",
    "user_id": "6",
    "phone": "+375297242145",
    "invite_code": "WXYZ34",
    "token": "9cf5c05f62ecf55f5e6214085bbea1130b0e84ed"
}
```
Ошибки:

- 400: Некорректный номер телефона
- 401: Неверный код
- 500: Ошибка сервера 



### 3. Получить профиль
**GET** `/api/profile/<str:phone>/`

Успешный ответ:
```json
{
    "phone": "+79123456789",
    "invite_code": "ABCD12",
    "activated_invite": "WXYZ34",
    "referral_phones": ["+79876543210", "+79998887766"]
}
```
Ошибки:

- 400: Некорректный номер телефона
- 400: Номер не найден

### 4. Активировать реферальный код
(только для авторизованных пользователей)

**PATCH** `/api/invite/`
```json
{
    "referral_code": "WXYZ34"
}
```

Успешный ответ:
```json
{
    "detail": "Реферальный код успешно активирован"
}
```

Ошибки:
- 400: Неверный код, уже активирован или собственный код
- 401: Не авторизован

## Аутентификация
Используется Token Authentication. Добавьте в заголовки:
```
Authorization: Token <ваш_токен>
```

## Модели данных
- Профиль: телефон, реферальный код, активированный код
- Реферальные связи: кто кого пригласил